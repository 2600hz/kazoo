{
    "_id": "_design/services",
    "language": "javascript",
    "views": {
        "by_tree": {
            "map": [
                "function (doc) {",
                "  if (doc.pvt_type != 'service' || doc.pvt_deleted) return;",
                "  emit(doc.pvt_type, null);",
                "}"
            ]
        },
        "cascade_quantities": {
            "map": [
                "function (doc) {",
                "  if (doc.pvt_type != 'service' || doc.pvt_deleted || !doc.quantities || !doc.quantities.account) return;",
                "  for (var key in doc.quantities.account) {",
                "    var obj = doc.quantities.account[key];",
                "    for (var prop in obj) {",
                "      if (obj[prop] < 1) continue;",
                "      for (var idx in doc.pvt_tree) {",
                "        emit([doc.pvt_tree[idx] || doc._id, key, prop], obj[prop]);",
                "      }",
                "    }",
                "  }",
                "}"
            ],
            "reduce": "_sum"
        },
        "totals": {
            "map": [
                "function (doc) {",
                "  if (doc.pvt_type != 'service' || doc.pvt_deleted || !doc.quantities || !doc.quantities.account) return;",
                "  for (var key in doc.quantities.account) {",
                "    var obj = doc.quantities.account[key];",
                "    for (var prop in obj) {",
                "      if (obj[prop] < 1) continue;",
                "      emit(key + '.' + prop, obj[prop]);",
                "    }",
                "  }",
                "}"
            ],
            "reduce": "_sum"
        }
    }
}
