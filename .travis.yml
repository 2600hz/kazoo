language: erlang
notifications:
  email:
    - engineering@2600hz.com
    - operations@2600hz.com
  irc:
    channels:
      - "irc.freenode.org#2600hz-dev"

otp_release:
  - 19.3

env:
  - USING_REBAR3=true
  - USING_REBAR3=false

sudo: required

addons:
  apt:
    packages:
      - xsltproc

cache:
  apt: true

before_install:
  - set -e

install:
  - if [[ "$USING_REBAR3" = 'true' ]]; then wget https://s3.amazonaws.com/rebar3/rebar3 && chmod +x ./rebar3; fi
  - export PATH="$PATH:$PWD"

script:
  - |
    if [[ "$USING_REBAR3" = 'true' ]]; then
      rebar3 compile
      APPS=$(echo core/*/ | sed 's%/ core/%,%g;s%core/%%;s%/%%')
      APPS=$APPS,$(echo applications/*/ | sed 's%/ applications/%,%g;s%applications/%%;s%/%%')
      DEBUG=1 rebar3 eunit --app=$APPS
    else
      ERLC_OPTS='-DPROPER' make compile-test
      make eunit
    fi
# To run tests yourself: make compile-test && make test

after_success:
  - if [[ "$TRAVIS_REPO_SLUG" = '2600hz/kazoo' ]] && [[ "$USING_REBAR3" = 'false' ]]; then make coverage-report; fi
