language: erlang
notifications:
  email:
    - engineering@2600hz.com
    - operations@2600hz.com

otp_release:
  - 21.3.8

# Lots of issues with erlang:get_stacktrace/0-related deprecations - going to take a while to unravel all this jazz

sudo: required

addons:
  apt:
    packages:
      - xsltproc
      - libreoffice
      - libtiff-tools
      - ghostscript

cache:
  apt: true

before_install:
  - set -e

before_script:
  - kerl list installations

script:
  - echo "DEPS += kazoo_proper kazoo_ast" > make/more_apps.mk
  - echo "dep_kazoo_proper = git https://github.com/2600hz/kazoo-proper" >> make/more_apps.mk
  - echo "dep_kazoo_ast = git https://github.com/2600hz/kazoo-ast" >> make/more_apps.mk
  - make fetch-apps
  - make fetch-core
  - rm -rf core/kazoo_{proper,ast} # remove core libs that are apps now
  - ERLC_OPTS='-DPROPER' make compile-test
  - make eunit
# To run tests yourself: make compile-test && make test

after_success:
  - if [[ "$TRAVIS_REPO_SLUG" == '2600hz/kazoo' ]]; then make coverage-report; fi
